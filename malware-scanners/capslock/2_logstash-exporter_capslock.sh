#!/bin/bash

# Single REPO_URL
REPO_URL="https://github.com/tdunlap607/logstash-exporter.git"

# Array of TAGs
TAGS=( "v1.6.1" "v1.6.2" "v1.6.3-malware" "v1.6.4" "v1.7.0")

# Single MAL_PATH
MAL_PATH="./cmd/exporter"

# Ensure the result directory exists
mkdir -p ./results

# Loop through the tags
for TAG in "${TAGS[@]}"; do
  # Dynamically create RESULT_FILE_NAME by replacing periods with underscores
  RESULT_FILE_NAME="2_logstash_${TAG//./_}.json"

  echo "Running capslock-helper for $REPO_URL with tag $TAG..."

  docker run -v ./results/:/output \
    -e REPO_URL="$REPO_URL" \
    -e TAG="$TAG" \
    -e RESULT_FILE_NAME="$RESULT_FILE_NAME" \
    -e MAL_PATH="$MAL_PATH" \
    capslock-helper

  echo "Finished capslock-helper for $TAG"
done